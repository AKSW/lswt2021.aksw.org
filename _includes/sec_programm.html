
<div class="section" id="Programm">

  {%- assign rooms = rootResource | rdf_container: "site:rooms" -%}
  {% for room in rooms %}
  <div class="container" id="{{ room | split: "#" | last }}">
    <h2 style="display: inline">{{ room | rdf_property: "rdfs:label", page.language }}</h2>

    <p>
      <em>{{ room | rdf_property: "rdfs:comment", page.language }}</em>
    </p>

    {% capture events_query %}
    SELECT ?event ?start ?end WHERE {
      <{{ rootResource.iri }}> schema:subEvent ?event .
      ?event schema:location <{{ room.iri }}> .
      optional { ?event schema:startDate ?start ; schema:endDate ?end }
    } ORDER BY ASC(?start)
    {% endcapture %}

    {% assign events = room | sparql_query: events_query %}
    {%- for events_row in events -%}
    {%- assign event = events_row.event -%}
    {%- assign start = events_row.start | date: "%H.%M" -%}
    {%- assign end = events_row.end | date: "%H.%M" -%}

    {% assign track = event | rdf_property: "site:track" %}
    {% assign pause = "lswt:pause" | rdf_get %}
    {% if track == pause %}
    <h3 class="pause">{% if events_row.start and events_row.end %}{{start}} bis {{end}}: {% endif %}{{ event | rdf_property: "rdfs:label", page.language }}</h3>
    {% else %}
    <h3 id="{{ event | split: "#" | last }}">{% if events_row.start and events_row.end %}{{start}} bis {{end}}: {% endif %}{{ event | rdf_property: "rdfs:label", page.language }}</h3>
    {% endif %}
    {% include performer.html event=event join="; " style="individual" %}
    
    {% assign description = event | rdf_property: "dc:description", page.language %}
    {% if description %}
    <p>{{ description }}</p>
    {% endif %}

    {% capture subEvents_query %}
    SELECT ?event WHERE {
      <{{ event.iri }}> schema:subEvent ?event .
      ?event schema:startDate ?date .
    } ORDER BY ASC(?date)
    {% endcapture %}

    {% assign subEvents = event | sparql_query: subEvents_query  %}

    <ul>
    {% for subEvent_row in subEvents %}
    {% assign subEvent = subEvent_row.event %}
    {% assign slideLink = subEvent | rdf_property: "schema:recordedIn" %}
      <li>
    {% if slideLink %}
      „<a id="{{ subEvent | split: "#" | last }}" href="{{ subEvent | rdf_property: "schema:recordedIn" }}">{{ subEvent | rdf_property: "rdfs:label" }}</a>“
    {% else %}
      <a id="{{ subEvent | split: "#" | last }}"></a>„{{ subEvent | rdf_property: "rdfs:label" }}“
    {% endif %}
       – {% include performer.html event=subEvent join="; " %}
       </li>
    {% endfor %}
    </ul>
    {% endfor %}
  </div>
  {% endfor %}
</div>
